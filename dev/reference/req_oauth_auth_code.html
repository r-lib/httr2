<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>OAuth with authorization code — req_oauth_auth_code • httr2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="OAuth with authorization code — req_oauth_auth_code"><meta name="description" content="Authenticate using the OAuth authorization code flow, as defined
by Section 4.1 of RFC 6749.
This flow is the most commonly used OAuth flow where the user
opens a page in their browser, approves the access, and then returns to R.
When possible, it redirects the browser back to a temporary local webserver
to capture the authorization code. When this is not possible (e.g., when
running on a hosted platform like RStudio Server), provide a custom
redirect_uri and httr2 will prompt the user to enter the code manually.
Learn more about the overall OAuth authentication flow in
https://httr2.r-lib.org/articles/oauth.html, and more about the motivations
behind this flow in
https://stack-auth.com/blog/oauth-from-first-principles."><meta property="og:description" content="Authenticate using the OAuth authorization code flow, as defined
by Section 4.1 of RFC 6749.
This flow is the most commonly used OAuth flow where the user
opens a page in their browser, approves the access, and then returns to R.
When possible, it redirects the browser back to a temporary local webserver
to capture the authorization code. When this is not possible (e.g., when
running on a hosted platform like RStudio Server), provide a custom
redirect_uri and httr2 will prompt the user to enter the code manually.
Learn more about the overall OAuth authentication flow in
https://httr2.r-lib.org/articles/oauth.html, and more about the motivations
behind this flow in
https://stack-auth.com/blog/oauth-from-first-principles."><meta property="og:image" content="https://httr2.r-lib.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="httr2.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">httr2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/httr2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/wrapping-apis.html">Wrapping APIs</a></li>
    <li><a class="dropdown-item" href="../articles/oauth.html">OAuth</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2025/07/httr2-1-2-0/">httr2 1.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2025/01/httr2-1-1-0/">httr2 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/11/httr2-1-0-0/">httr2 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/httr2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>OAuth with authorization code</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/httr2/blob/main/R/oauth-flow-auth-code.R" class="external-link"><code>R/oauth-flow-auth-code.R</code></a></small>
      <div class="d-none name"><code>req_oauth_auth_code.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Authenticate using the OAuth <strong>authorization code flow</strong>, as defined
by <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.1" class="external-link">Section 4.1 of RFC 6749</a>.</p>
<p>This flow is the most commonly used OAuth flow where the user
opens a page in their browser, approves the access, and then returns to R.
When possible, it redirects the browser back to a temporary local webserver
to capture the authorization code. When this is not possible (e.g., when
running on a hosted platform like RStudio Server), provide a custom
<code>redirect_uri</code> and httr2 will prompt the user to enter the code manually.</p>
<p>Learn more about the overall OAuth authentication flow in
<a href="https://httr2.r-lib.org/articles/oauth.html">https://httr2.r-lib.org/articles/oauth.html</a>, and more about the motivations
behind this flow in
<a href="https://stack-auth.com/blog/oauth-from-first-principles" class="external-link">https://stack-auth.com/blog/oauth-from-first-principles</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">req_oauth_auth_code</span><span class="op">(</span></span>
<span>  <span class="va">req</span>,</span>
<span>  <span class="va">client</span>,</span>
<span>  <span class="va">auth_url</span>,</span>
<span>  scope <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pkce <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  auth_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  token_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  redirect_uri <span class="op">=</span> <span class="fu"><a href="oauth_redirect_uri.html">oauth_redirect_uri</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cache_disk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cache_key <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">oauth_flow_auth_code</span><span class="op">(</span></span>
<span>  <span class="va">client</span>,</span>
<span>  <span class="va">auth_url</span>,</span>
<span>  scope <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pkce <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  auth_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  token_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  redirect_uri <span class="op">=</span> <span class="fu"><a href="oauth_redirect_uri.html">oauth_redirect_uri</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-req">req<a class="anchor" aria-label="anchor" href="#arg-req"></a></dt>
<dd><p>A httr2 <a href="request.html">request</a> object.</p></dd>


<dt id="arg-client">client<a class="anchor" aria-label="anchor" href="#arg-client"></a></dt>
<dd><p>An <code><a href="oauth_client.html">oauth_client()</a></code>.</p></dd>


<dt id="arg-auth-url">auth_url<a class="anchor" aria-label="anchor" href="#arg-auth-url"></a></dt>
<dd><p>Authorization url; you'll need to discover this by reading
the documentation.</p></dd>


<dt id="arg-scope">scope<a class="anchor" aria-label="anchor" href="#arg-scope"></a></dt>
<dd><p>Scopes to be requested from the resource owner.</p></dd>


<dt id="arg-pkce">pkce<a class="anchor" aria-label="anchor" href="#arg-pkce"></a></dt>
<dd><p>Use "Proof Key for Code Exchange"? This adds an extra layer of
security and should always be used if supported by the server.</p></dd>


<dt id="arg-auth-params">auth_params<a class="anchor" aria-label="anchor" href="#arg-auth-params"></a></dt>
<dd><p>A list containing additional parameters passed to
<code><a href="oauth_flow_auth_code_url.html">oauth_flow_auth_code_url()</a></code>.</p></dd>


<dt id="arg-token-params">token_params<a class="anchor" aria-label="anchor" href="#arg-token-params"></a></dt>
<dd><p>List containing additional parameters passed to the
<code>token_url</code>.</p></dd>


<dt id="arg-redirect-uri">redirect_uri<a class="anchor" aria-label="anchor" href="#arg-redirect-uri"></a></dt>
<dd><p>URL to redirect back to after authorization is complete.
Often this must be registered with the API in advance.</p>
<p>httr2 supports three forms of redirect. Firstly, you can use a <code>localhost</code>
url (the default), where httr2 will set up a temporary webserver to listen
for the OAuth redirect. In this case, httr2 will automatically append a
random port. If you need to set it to a fixed port because the API requires
it, then specify it with (e.g.) <code>"http://localhost:1011"</code>. This technique
works well when you are working on your own computer.</p>
<p>Secondly, you can provide a URL to a website that uses Javascript to
give the user a code to copy and paste back into the R session (see
<a href="https://www.tidyverse.org/google-callback/" class="external-link">https://www.tidyverse.org/google-callback/</a> and
<a href="https://github.com/r-lib/gargle/blob/main/inst/pseudo-oob/google-callback/index.html" class="external-link">https://github.com/r-lib/gargle/blob/main/inst/pseudo-oob/google-callback/index.html</a>
for examples). This is less convenient (because it requires more
user interaction) but also works in hosted environments like RStudio
Server.</p>
<p>Finally, hosted platforms might set the <code>HTTR2_OAUTH_REDIRECT_URL</code> and
<code>HTTR2_OAUTH_CODE_SOURCE_URL</code> environment variables. In this case, httr2
will use <code>HTTR2_OAUTH_REDIRECT_URL</code> for redirects by default, and poll the
<code>HTTR2_OAUTH_CODE_SOURCE_URL</code> endpoint with the state parameter until it
receives a code in the response (or encounters an error). This delegates
completion of the authorization flow to the hosted platform.</p></dd>


<dt id="arg-cache-disk">cache_disk<a class="anchor" aria-label="anchor" href="#arg-cache-disk"></a></dt>
<dd><p>Should the access token be cached on disk? This reduces
the number of times that you need to re-authenticate at the cost of
storing access credentials on disk.</p>
<p>Learn more in <a href="https://httr2.r-lib.org/articles/oauth.html">https://httr2.r-lib.org/articles/oauth.html</a>.</p></dd>


<dt id="arg-cache-key">cache_key<a class="anchor" aria-label="anchor" href="#arg-cache-key"></a></dt>
<dd><p>If you want to cache multiple tokens per app, use this
key to disambiguate them.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>req_oauth_auth_code()</code> returns a modified HTTP <a href="request.html">request</a> that will
use OAuth; <code>oauth_flow_auth_code()</code> returns an <a href="oauth_token.html">oauth_token</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="security-considerations">Security considerations<a class="anchor" aria-label="anchor" href="#security-considerations"></a></h2>
    <p>The authorization code flow is used for both web applications and native
applications (which are equivalent to R packages). <a href="https://datatracker.ietf.org/doc/html/rfc8252" class="external-link">RFC 8252</a> spells out
important considerations for native apps. Most importantly there's no way
for native apps to keep secrets from their users. This means that the
server should either not require a <code>client_secret</code> (i.e. it should be a
public client and not a confidential client) or ensure that possession of
the <code>client_secret</code> doesn't grant any significant privileges.</p>
<p>Only modern APIs from major providers (like Azure and Google) explicitly
support native apps. However, in most cases, even for older APIs, possessing
the <code>client_secret</code> provides limited ability to perform harmful actions.
Therefore, our general principle is that it's acceptable to include it in an
R package, as long as it's mildly obfuscated to protect against credential
scraping attacks (which aim to acquire large numbers of client secrets by
scanning public sites like GitHub). The goal is to ensure that obtaining your
client credentials is more work than just creating a new client.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="oauth_flow_auth_code_url.html">oauth_flow_auth_code_url()</a></code> for the components necessary to
write your own auth code flow, if the API you are wrapping does not adhere
closely to the standard.</p>
<p>Other OAuth flows:
<code><a href="req_oauth_bearer_jwt.html">req_oauth_bearer_jwt</a>()</code>,
<code><a href="req_oauth_client_credentials.html">req_oauth_client_credentials</a>()</code>,
<code><a href="req_oauth_password.html">req_oauth_password</a>()</code>,
<code><a href="req_oauth_refresh.html">req_oauth_refresh</a>()</code>,
<code><a href="req_oauth_token_exchange.html">req_oauth_token_exchange</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">req_auth_github</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">req_oauth_auth_code</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">req</span>,</span></span>
<span class="r-in"><span>    client <span class="op">=</span> <span class="fu"><a href="example_url.html">example_github_client</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    auth_url <span class="op">=</span> <span class="st">"https://github.com/login/oauth/authorize"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="request.html">request</a></span><span class="op">(</span><span class="st">"https://api.github.com/user"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">req_auth_github</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">&lt;httr2_request&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">GET</span> https://api.github.com/user</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Body</span>: empty</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Policies:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * <span style="color: #00BB00;">auth_sign </span>: &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * <span style="color: #00BB00;">auth_oauth</span>: TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer></body></html>

