<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Secret management — secrets • httr2</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Secret management — secrets"><meta name="description" content="httr2 provides a handful of functions designed for working with confidential
data. These are useful because testing packages that use httr2 often
requires some confidential data that needs to be available for testing,
but should not be available to package users.
secret_encrypt() and secret_decrypt() work with individual strings
secret_encrypt_file() encrypts a file in place and
secret_decrypt_file() decrypts a file in a temporary location.
secret_write_rds() and secret_read_rds() work with .rds files
secret_make_key() generates a random string to use as a key.
secret_has_key() returns TRUE if the key is available; you can
use it in examples and vignettes that you want to evaluate on your CI,
but not for CRAN/package users.


These all look for the key in an environment variable. When used inside of
testthat, they will automatically testthat::skip() the test if the env var
isn't found. (Outside of testthat, they'll error if the env var isn't
found.)"><meta property="og:description" content="httr2 provides a handful of functions designed for working with confidential
data. These are useful because testing packages that use httr2 often
requires some confidential data that needs to be available for testing,
but should not be available to package users.
secret_encrypt() and secret_decrypt() work with individual strings
secret_encrypt_file() encrypts a file in place and
secret_decrypt_file() decrypts a file in a temporary location.
secret_write_rds() and secret_read_rds() work with .rds files
secret_make_key() generates a random string to use as a key.
secret_has_key() returns TRUE if the key is available; you can
use it in examples and vignettes that you want to evaluate on your CI,
but not for CRAN/package users.


These all look for the key in an environment variable. When used inside of
testthat, they will automatically testthat::skip() the test if the env var
isn't found. (Outside of testthat, they'll error if the env var isn't
found.)"><meta property="og:image" content="https://httr2.r-lib.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="httr2.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">httr2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/httr2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/wrapping-apis.html">Wrapping APIs</a></li>
    <li><a class="dropdown-item" href="../articles/oauth.html">OAuth</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2025/01/httr2-1-1-0/">httr2 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/11/httr2-1-0-0/">httr2 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/httr2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Secret management</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/httr2/blob/main/R/secret.R" class="external-link"><code>R/secret.R</code></a></small>
      <div class="d-none name"><code>secrets.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>httr2 provides a handful of functions designed for working with confidential
data. These are useful because testing packages that use httr2 often
requires some confidential data that needs to be available for testing,
but should not be available to package users.</p><ul><li><p><code>secret_encrypt()</code> and <code>secret_decrypt()</code> work with individual strings</p></li>
<li><p><code>secret_encrypt_file()</code> encrypts a file in place and
<code>secret_decrypt_file()</code> decrypts a file in a temporary location.</p></li>
<li><p><code>secret_write_rds()</code> and <code>secret_read_rds()</code> work with <code>.rds</code> files</p></li>
<li><p><code>secret_make_key()</code> generates a random string to use as a key.</p></li>
<li><p><code>secret_has_key()</code> returns <code>TRUE</code> if the key is available; you can
use it in examples and vignettes that you want to evaluate on your CI,
but not for CRAN/package users.</p></li>
</ul><p>These all look for the key in an environment variable. When used inside of
testthat, they will automatically <code><a href="https://testthat.r-lib.org/reference/skip.html" class="external-link">testthat::skip()</a></code> the test if the env var
isn't found. (Outside of testthat, they'll error if the env var isn't
found.)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">secret_make_key</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">secret_encrypt</span><span class="op">(</span><span class="va">x</span>, <span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">secret_decrypt</span><span class="op">(</span><span class="va">encrypted</span>, <span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">secret_write_rds</span><span class="op">(</span><span class="va">x</span>, <span class="va">path</span>, <span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">secret_read_rds</span><span class="op">(</span><span class="va">path</span>, <span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">secret_decrypt_file</span><span class="op">(</span><span class="va">path</span>, <span class="va">key</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">secret_encrypt_file</span><span class="op">(</span><span class="va">path</span>, <span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">secret_has_key</span><span class="op">(</span><span class="va">key</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Object to encrypt. Must be a string for <code>secret_encrypt()</code>.</p></dd>


<dt id="arg-key">key<a class="anchor" aria-label="anchor" href="#arg-key"></a></dt>
<dd><p>Encryption key; this is the password that allows you to "lock"
and "unlock" the secret. The easiest way to specify this is as the
name of an environment variable. Alternatively, if you already have
a base64url encoded string, you can wrap it in <code><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I()</a></code>, or you can pass
the raw vector in directly.</p></dd>


<dt id="arg-encrypted">encrypted<a class="anchor" aria-label="anchor" href="#arg-encrypted"></a></dt>
<dd><p>String to decrypt</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Path to file to encrypted file to read or write. For
<code>secret_write_rds()</code> and <code>secret_read_rds()</code> this should be an <code>.rds</code>
file.</p></dd>


<dt id="arg-envir">envir<a class="anchor" aria-label="anchor" href="#arg-envir"></a></dt>
<dd><p>The decrypted file will be automatically deleted when
this environment exits. You should only need to set this argument if you
want to pass the unencrypted file to another function.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>

<ul><li><p><code>secret_decrypt()</code> and <code>secret_encrypt()</code> return strings.</p></li>
<li><p><code>secret_decrypt_file()</code> returns a path to a temporary file;
<code>secret_encrypt_file()</code> encrypts the file in place.</p></li>
<li><p><code>secret_write_rds()</code> returns <code>x</code> invisibly; <code>secret_read_rds()</code>
returns the saved object.</p></li>
<li><p><code>secret_make_key()</code> returns a string with class <code>AsIs</code>.</p></li>
<li><p><code>secret_has_key()</code> returns <code>TRUE</code> or <code>FALSE</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="basic-workflow">Basic workflow<a class="anchor" aria-label="anchor" href="#basic-workflow"></a></h2>

<ol><li><p>Use <code>secret_make_key()</code> to generate a password. Make this available
as an env var (e.g. <code>{MYPACKAGE}_KEY</code>) by adding a line to your
<code>.Renviron</code>.</p></li>
<li><p>Encrypt strings with <code>secret_encrypt()</code>, files with
<code>secret_encrypt_file()</code>, and other data with <code>secret_write_rds()</code>,
setting <code>key = "{MYPACKAGE}_KEY"</code>.</p></li>
<li><p>In your tests, decrypt the data with <code>secret_decrypt()</code>,
<code>secret_decrypt_file()</code>, or <code>secret_read_rds()</code> to match how you encrypt
it.</p></li>
<li><p>If you push this code to your CI server, it will already "work" because
all functions automatically skip tests when your <code>{MYPACKAGE}_KEY</code>
env var isn't set. To make the tests actually run, you'll need to set
the env var using whatever tool your CI system provides for setting
env vars. Make sure to carefully inspect the test output to check that
the skips have actually gone away.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu">secret_make_key</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">secret_write_rds</span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">path</span>, key <span class="op">=</span> <span class="va">key</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">secret_read_rds</span><span class="op">(</span><span class="va">path</span>, <span class="va">key</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># While you can manage the key explicitly in a variable, it's much</span></span></span>
<span class="r-in"><span><span class="co"># easier to store in an environment variable. In real life, you should</span></span></span>
<span class="r-in"><span><span class="co"># NEVER use `Sys.setenv()` to create this env var because you will</span></span></span>
<span class="r-in"><span><span class="co"># also store the secret in your `.Rhistory`. Instead add it to your</span></span></span>
<span class="r-in"><span><span class="co"># .Renviron using `usethis::edit_r_environ()` or similar.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"MY_KEY"</span> <span class="op">=</span> <span class="va">key</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">secret_encrypt</span><span class="op">(</span><span class="st">"This is a secret"</span>, <span class="st">"MY_KEY"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "AEab4ECxhvY202JD3tjrOug0wEMcpxACQj-xhYyoDFM"</span>
<span class="r-in"><span><span class="fu">secret_decrypt</span><span class="op">(</span><span class="va">x</span>, <span class="st">"MY_KEY"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "This is a secret"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

