<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="req_retry() alters req_perform() so that it will automatically retry
in the case of failure. To activate it, you must specify either the total
number of requests to make with max_tries or the total amount of time
to spend with max_seconds. Then req_perform() will retry if:
The either the HTTP request or HTTP response doesn't complete successfully
leading to an error from curl, the lower-level library that httr uses to
perform HTTP request. This occurs, for example, if your wifi is down.
The error is &quot;transient&quot;, i.e. it's an HTTP error that can be resolved
by waiting. By default, 429 and 503 statuses are treated as transient,
but if the API you are wrapping has other transient status codes (or
conveys transient-ness with some other property of the response), you can
override the default with is_transient.


It's a bad idea to immediately retry a request, so req_perform() will
wait a little before trying again:
If the response contains the Retry-After header, httr2 will wait the
amount of time it specifies. If the API you are wrapping conveys this
information with a different header (or other property of the response)
you can override the default behaviour with retry_after.
Otherwise, httr2 will use &quot;truncated exponential backoff with full
jitter&quot;, i.e. it will wait a random amount of time between one second and
2 ^ tries seconds, capped to at most 60 seconds. In other words, it
waits runif(1, 1, 2) seconds after the first failure, runif(1, 1, 4)
after the second, runif(1, 1, 8) after the third, and so on. If you'd
prefer a different strategy, you can override the default with backoff.

"><title>Control when a request will retry, and how long it will wait between tries — req_retry • httr2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.7/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.7/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Control when a request will retry, and how long it will wait between tries — req_retry"><meta property="og:description" content="req_retry() alters req_perform() so that it will automatically retry
in the case of failure. To activate it, you must specify either the total
number of requests to make with max_tries or the total amount of time
to spend with max_seconds. Then req_perform() will retry if:
The either the HTTP request or HTTP response doesn't complete successfully
leading to an error from curl, the lower-level library that httr uses to
perform HTTP request. This occurs, for example, if your wifi is down.
The error is &quot;transient&quot;, i.e. it's an HTTP error that can be resolved
by waiting. By default, 429 and 503 statuses are treated as transient,
but if the API you are wrapping has other transient status codes (or
conveys transient-ness with some other property of the response), you can
override the default with is_transient.


It's a bad idea to immediately retry a request, so req_perform() will
wait a little before trying again:
If the response contains the Retry-After header, httr2 will wait the
amount of time it specifies. If the API you are wrapping conveys this
information with a different header (or other property of the response)
you can override the default behaviour with retry_after.
Otherwise, httr2 will use &quot;truncated exponential backoff with full
jitter&quot;, i.e. it will wait a random amount of time between one second and
2 ^ tries seconds, capped to at most 60 seconds. In other words, it
waits runif(1, 1, 2) seconds after the first failure, runif(1, 1, 4)
after the second, runif(1, 1, 8) after the third, and so on. If you'd
prefer a different strategy, you can override the default with backoff.

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="httr2.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">httr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/httr2.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/wrapping-apis.html">Wrapping APIs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/httr2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Control when a request will retry, and how long it will wait between tries</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/httr2/blob/HEAD/R/req-retries.R" class="external-link"><code>R/req-retries.R</code></a></small>
      <div class="d-none name"><code>req_retry.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>req_retry()</code> alters <code><a href="req_perform.html">req_perform()</a></code> so that it will automatically retry
in the case of failure. To activate it, you must specify either the total
number of requests to make with <code>max_tries</code> or the total amount of time
to spend with <code>max_seconds</code>. Then <code><a href="req_perform.html">req_perform()</a></code> will retry if:</p><ul><li><p>The either the HTTP request or HTTP response doesn't complete successfully
leading to an error from curl, the lower-level library that httr uses to
perform HTTP request. This occurs, for example, if your wifi is down.</p></li>
<li><p>The error is "transient", i.e. it's an HTTP error that can be resolved
by waiting. By default, 429 and 503 statuses are treated as transient,
but if the API you are wrapping has other transient status codes (or
conveys transient-ness with some other property of the response), you can
override the default with <code>is_transient</code>.</p></li>
</ul><p>It's a bad idea to immediately retry a request, so <code><a href="req_perform.html">req_perform()</a></code> will
wait a little before trying again:</p><ul><li><p>If the response contains the <code>Retry-After</code> header, httr2 will wait the
amount of time it specifies. If the API you are wrapping conveys this
information with a different header (or other property of the response)
you can override the default behaviour with <code>retry_after</code>.</p></li>
<li><p>Otherwise, httr2 will use "truncated exponential backoff with full
jitter", i.e. it will wait a random amount of time between one second and
<code>2 ^ tries</code> seconds, capped to at most 60 seconds. In other words, it
waits <code>runif(1, 1, 2)</code> seconds after the first failure, <code>runif(1, 1, 4)</code>
after the second, <code>runif(1, 1, 8)</code> after the third, and so on. If you'd
prefer a different strategy, you can override the default with <code>backoff</code>.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">req_retry</span><span class="op">(</span></span>
<span>  <span class="va">req</span>,</span>
<span>  max_tries <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_seconds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  is_transient <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  backoff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  after <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>req</dt>
<dd><p>A <a href="request.html">request</a>.</p></dd>


<dt>max_tries, max_seconds</dt>
<dd><p>Cap the maximum number of attempts with
<code>max_tries</code> or the total elapsed time from the first request with
<code>max_seconds</code>. If neither option is supplied (the default), <code><a href="req_perform.html">req_perform()</a></code>
will not retry.</p></dd>


<dt>is_transient</dt>
<dd><p>A predicate function that takes a single argument
(the response) and returns <code>TRUE</code> or <code>FALSE</code> specifying whether or not
the response represents a transient error.</p></dd>


<dt>backoff</dt>
<dd><p>A function that takes a single argument (the number of failed
attempts so far) and returns the number of seconds to wait.</p></dd>


<dt>after</dt>
<dd><p>A function that takes a single argument (the response) and
returns either a number of seconds to wait or <code>NULL</code>, which indicates
that a precise wait time is not available that the <code>backoff</code> strategy
should be used instead..</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A modified HTTP <a href="request.html">request</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="req_throttle.html">req_throttle()</a></code> if the API has a rate-limit but doesn't expose
the limits in the response.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># google APIs assume that a 500 is also a transient error</span></span></span>
<span class="r-in"><span><span class="fu"><a href="request.html">request</a></span><span class="op">(</span><span class="st">"http://google.com"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">req_retry</span><span class="op">(</span>is_transient <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="resp_status.html">resp_status</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">429</span>, <span class="fl">500</span>, <span class="fl">503</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">&lt;httr2_request&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">GET</span> http://google.com</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Body</span>: empty</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Policies:</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • <span style="color: #00BB00;">retry_is_transient</span>: a &lt;rlang_lambda_function/function&gt; object</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use a constant 10s delay after every failure</span></span></span>
<span class="r-in"><span><span class="fu"><a href="request.html">request</a></span><span class="op">(</span><span class="st">"http://example.com"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">req_retry</span><span class="op">(</span>backoff <span class="op">=</span> <span class="op">~</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">&lt;httr2_request&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">GET</span> http://example.com</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Body</span>: empty</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Policies:</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • <span style="color: #00BB00;">retry_backoff</span>: a &lt;rlang_lambda_function/function&gt; object</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># When rate-limited, GitHub's API returns a 403 with</span></span></span>
<span class="r-in"><span><span class="co"># `X-RateLimit-Remaining: 0` and an Unix time stored in the</span></span></span>
<span class="r-in"><span><span class="co"># `X-RateLimit-Reset` header. This takes a bit more work to handle:</span></span></span>
<span class="r-in"><span><span class="va">github_is_transient</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="resp_status.html">resp_status</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">==</span> <span class="fl">403</span> <span class="op">&amp;&amp;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="resp_headers.html">resp_header</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"X-RateLimit-Remaining"</span><span class="op">)</span>, <span class="st">"0"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">github_after</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="resp_headers.html">resp_header</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"X-RateLimit-Reset"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">time</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="request.html">request</a></span><span class="op">(</span><span class="st">"http://api.github.com"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">req_retry</span><span class="op">(</span></span></span>
<span class="r-in"><span>    is_transient <span class="op">=</span> <span class="va">github_is_transient</span>,</span></span>
<span class="r-in"><span>    after <span class="op">=</span> <span class="va">github_after</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">&lt;httr2_request&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">GET</span> http://api.github.com</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Body</span>: empty</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Policies:</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • <span style="color: #00BB00;">retry_is_transient</span>: a function</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • <span style="color: #00BB00;">retry_after</span>: a function</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

